<!DOCTYPE html>
<html lang="de">
  <head>
  <meta charset="UTF-8">

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <title>noelli - Kind Gottes, Programmierer und IT-Spezialist</title>

  <!-- CSS -->
  <link rel="stylesheet" type="text/css" media="all" href='assets/css/min/index.min.css' />

  <link rel="preload" media="all" href='/assets/css/materialize.css' as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" media="all" href='/assets/css/materialize.css'></noscript>

  <link rel="preload" media="all" href='/assets/css/style.css' as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" media="all" href='/assets/css/style.css'></noscript>

  <link rel="preload" media="all" href="https://fonts.googleapis.com/icon?family=Material+Icons" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" media="all" href="https://fonts.googleapis.com/icon?family=Material+Icons"></noscript>
  <style>
    body {
      display: flex;
      min-height: 100vh;
      flex-direction: column;
    }
  
    main {
      flex: 1 0 auto;
    }

    .separator {
      display: flex;
      align-items: center;
      text-align: center;
    }
    .separator::before, .separator::after {
        content: '';
        flex: 1;
        margin-top: .5em;
        border-bottom: 1px solid #000;
    }
    .separator::before {
        margin-right: 1em;
    }
    .separator::after {
        margin-left: 1em;
    }

    .indent {
      margin-left: 10px;
    }
  </style>
<!-- Favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href='/assets/images/favicon/apple-icon-57x57.png'>
  <link rel="apple-touch-icon" sizes="60x60" href='/assets/images/favicon/apple-icon-60x60.png'>
  <link rel="apple-touch-icon" sizes="72x72" href='/assets/images/favicon/apple-icon-72x72.png'>
  <link rel="apple-touch-icon" sizes="76x76" href='/assets/images/favicon/apple-icon-76x76.png'>
  <link rel="apple-touch-icon" sizes="114x114" href='/assets/images/favicon/apple-icon-114x114.png'>
  <link rel="apple-touch-icon" sizes="120x120" href='/assets/images/favicon/apple-icon-120x120.png'>
  <link rel="apple-touch-icon" sizes="144x144" href='/assets/images/favicon/apple-icon-144x144.png'>
  <link rel="apple-touch-icon" sizes="152x152" href='/assets/images/favicon/apple-icon-152x152.png'>
  <link rel="apple-touch-icon" sizes="180x180" href='/assets/images/favicon/apple-icon-180x180.png'>
  <link rel="icon" type="image/png" sizes="192x192"  href='/assets/images/favicon/android-icon-192x192.png'>
  <link rel="icon" type="image/png" sizes="32x32" href='/assets/images/favicon/favicon-32x32.png'>
  <link rel="icon" type="image/png" sizes="96x96" href='/assets/images/favicon/favicon-96x96.png'>
  <link rel="icon" type="image/png" sizes="16x16" href='/assets/images/favicon/favicon-16x16.png'>
  <link rel="manifest" href='/assets/images/favicon/manifest.json'>
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content='/assets/images/favicon/ms-icon-144x144.png'>
  <meta name="theme-color" content="#ffffff">


  
  <!-- Matomo -->
  <script type="text/javascript">

    function setCookie(c_name,value,exdays){var exdate=new Date();exdate.setDate(exdate.getDate() + exdays);var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());document.cookie=c_name + "=" + c_value;}
    function getCookie(c_name){var c_value = document.cookie;var c_start = c_value.indexOf(" " + c_name + "=");if (c_start == -1){c_start = c_value.indexOf(c_name + "=");}if (c_start == -1){c_value = null;}else{c_start = c_value.indexOf("=", c_start) + 1;var c_end = c_value.indexOf(";", c_start);if (c_end == -1){c_end = c_value.length;}c_value = unescape(c_value.substring(c_start,c_end));}return c_value;}
    function delCookie(name){document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';}

    var _paq = window._paq || [];
    _paq.push(['requireConsent']);
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setCookieDomain", "*.noell.li"]);
    _paq.push(["setDomains", ["*.noell.li","*.noell.li"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://stat.noell.li/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <noscript><p><img src="https://stat.noell.li/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt="" /></p></noscript>
  <!-- End Matomo Code -->
  
</head>
<body >


  <header>
  <!-- Navbar -->
  <div class="navbar-fixed">
    <!-- Dropdown Structure -->
    <ul id="dropdown1" class="dropdown-content">
      
        <li><a href="/projects/Homepage.html">Diese Homepage</a></li>
      
        <li><a href="/projects/QR-Translator.html">QR-Translator</a></li>
      
        <li><a href="/projects/WIP-BACnet-wiki.html">BACnet Wiki -WIP-</a></li>
      
        <li><a href="/projects/streaming-server.html">NGINX (Multi-) Streaming Server</a></li>
      

    </ul>
    <nav class="green darken-3" role="navigation">
        <div class="nav-wrapper container">
            <a id="logo-container" href="/" class="brand-logo">
              <picture><source srcset="/assets/generated/noelli-30-55588e8ae.webp 30w, /assets/generated/noelli-64-55588e8ae.webp 64w, /assets/generated/noelli-100-55588e8ae.webp 100w, /assets/generated/noelli-400-55588e8ae.webp 400w, /assets/generated/noelli-460-55588e8ae.webp 460w" type="image/webp"><source srcset="/assets/generated/noelli-30-55588e8ae.png 30w, /assets/generated/noelli-64-55588e8ae.png 64w, /assets/generated/noelli-100-55588e8ae.png 100w, /assets/generated/noelli-400-55588e8ae.png 400w, /assets/generated/noelli-460-55588e8ae.png 460w" type="image/png"><img class="navbar-fixed" src="/assets/generated/noelli-460-55588e8ae.png"></picture>

            </a>
            <ul class="right hide-on-med-and-down">
              
              <li><a class="icon-large" target="_blank" href="https://github.com/noelli"><i class="fab fa-github"></i></a></li>
              
              
              
                
                <li><a href="/en/projects/streaming-server.html" >English</a></li>
              
              <!-- Dropdown Trigger -->
              <li><a class="dropdown-trigger" href="#!" data-target="dropdown1">Projekte<i class="material-icons right">arrow_drop_down</i></a></li>
            </ul>
            <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        </div>
    </nav>
  </div>
  <ul id="nav-mobile" class="sidenav">
      <li><a class="disabled">Links:</a></li>
      
      <li class="indent"><a class="icon-large" target="_blank" href="https://github.com/noelli"><i class="fab fa-github"></i> Github</a></li>
      
      
      
        
        <li class="indent"><a href="/en/projects/streaming-server.html" >English</a></li>
      
      <hr>
      <li><a class="disabled">Projekte:</a></li>
      
        <li class="indent"><a href="/projects/Homepage.html">Diese Homepage</a></li>
      
        <li class="indent"><a href="/projects/QR-Translator.html">QR-Translator</a></li>
      
        <li class="indent"><a href="/projects/WIP-BACnet-wiki.html">BACnet Wiki -WIP-</a></li>
      
        <li class="indent"><a href="/projects/streaming-server.html">NGINX (Multi-) Streaming Server</a></li>
      
  </ul>
  </header>
  
  <!-- MAIN Content -->
  <main>
    <div class="section no-pad-bot" id="index-banner">
      <!-- MAIN Content -->
<div class="container">
    <!-- MAIN Content -->
<div class="row">
    <div class="col s12 m8 l9"><h1>NGINX (Multi-) Streaming Server</h1></div>
</div>
<div class="row">
    <div class="col s12 m8 l9"> <!-- Note that "m8 l9" was added -->
        <!-- ToDo: Add translation -->
<h4 id="einführung">Einführung</h4>
<p>Dieses Tutorial und die dazugehörigen Skripte wurden urspünglich in einem <a href="https://gist.github.com/noelli/489c5c0cf5a561a32f757d7513465344">Gist</a> Veröffentlicht und vereinfachen die Installation eines eigenen RTMP-Servers mithilfe von NGINX.</p>

<p>Wir hatten nicht nur die Anforderung an verschiedene Dienste wie Youtube, Twitch oder Facebook gleichzeitig zu streamen, sondern benötigten auch “Lokale Wiedergabemöglichkeiten” also Empfänger in anderen Räumlichkeiten in der gleichen Liegenschaft.
Dies bedingt möglichst niedrige Latenzen, welche mit den üblichen Multi-Streaming Anbietern in der Cloud nicht erreicht werden können, sodass wir uns für eine Topologie wie unten angezeigt entschieden haben.</p>

<p>Die mit diesen Skripten und Anleitungen hergestellte Lösung ist auf einem kostengünstigen Raspberry Pi 4 vollfunktionsfähig, der einzige Flaschenhals ist die Netzwerkanbindung!</p>

<p><img src="/assets/images/NGINXStreamingServer.svg" alt="Network Diagram of a local NGINX Streaming Server by noell.li" style="     margin-top: 50px;     margin-bottom: 50px;     width: 100%; " /></p>

<h2 id="nginx-mit-rtmp-modul-kompilieren-und-multi-streaming-einstellen">NGINX mit RTMP-Modul kompilieren und Multi-Streaming einstellen</h2>
<p>Diese Skripte werden NGINX mit dem RTMP Modul installieren, dabei werden die “normalen” Ordner genutzt, wie auch bspw. von apt-get.</p>

<p>Der RTMP-Server den Sie damit erhalten kann für eins oder mehr der folgenden Dinge genutzt werden:</p>
<ul>
  <li>Streams im localen Netzerk bereitstellen</li>
  <li>RTMP Streams in HLS-Video umwandeln</li>
  <li>Streams an ein oder mehrere Webseiten wie z.B. Youtube senden</li>
  <li>Streams auf Festplatte speichern</li>
  <li>vieles, vieles mehr: Schau mal in die Offizielle Doku: <a href="https://github.com/arut/nginx-rtmp-module/wiki/Directives">Nginx RTMP-Module</a></li>
</ul>

<p>Und es läuft problemlos auf einem Raspberry Pi 4!</p>

<h2 id="installation">Installation</h2>
<p>Wenn noch kein Git vorhanden ist, installiere es: <a href="https://git-scm.com/downloads">Download Git</a></p>

<p>Hole die Skripte:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://gist.github.com/489c5c0cf5a561a32f757d7513465344.git install_nginx
</code></pre></div></div>

<p>Wechsel in das Ziel-Verzeichis:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>install_nginx
</code></pre></div></div>
<p>Führe das Haupt Installationsskript aus:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo install </span>install_nginx.sh
</code></pre></div></div>

<h3 id="streame-auf-deinen-neuen-rtmp-server">Streame auf deinen neuen RTMP-Server:</h3>
<p>Starte einen Stream von OBS oder eines anderen Streaming-Gerätes auf folgende URL (Hostname ist hier die IP oder der Name deines Servers):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rtmp://hostname:1935/live
</code></pre></div></div>
<p>Wenn du einen API-Key z.B. von Youtube hast, stelle ihn in OBS ein oder verändere die URL wie folgt:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rtmp://hostname:1935/live/your-api-key
</code></pre></div></div>

<h2 id="erklärung-und-optionen">Erklärung und Optionen:</h2>
<p>Dieses Skript installiert eine RTMP-Configuration welche Livestreams annimt und an CLient-Verbindungen verteilt.</p>

<p>Standardmäßig sind folgende Optionen deaktiviert aber können, bei Bedarf, in der Konfigurations-Datei  <code class="language-plaintext highlighter-rouge">/etc/nginx/nginx.conf</code> aktiviert werden:</p>

<h3 id="veröffentlichen-zu-einem-streaming-service-zb-youtube">Veröffentlichen zu einem Streaming-Service (z.B. Youtube):</h3>
<p>Wenn du die Push Option aktivierst, wird jeder ankommende Stream auf die genannte URL weitergeleitet, standardmäßig Youtube.</p>

<h3 id="lokale-vlc-wiedergabe-zb-auf-einem-raspberry-pi">Lokale VLC Wiedergabe (z.B. auf einem Raspberry Pi):</h3>
<p>Diese Option ist sehr Hilfreich wenn du in das Internet Livestreamen möchtest aber auch in einen Lokalen Raum Streamen möchtest.</p>

<p>Der Befehl nach exec_publish wird zu beginn eines neuen Livestreams ausgeführt und nach beendigung desselben beendet.</p>

<h4 id="vlc-wiedergabe-auf-anderem-linux-gerät">VLC Wiedergabe auf anderem Linux-Gerät</h4>
<p>Der VLC-Befehl kann abgewandelt werden um VLC-Fenster auf einem anderen Gerät zu starten, via SSH.</p>

<p>Um das ans laufen zu bekommen müssen wir ein paar Vorbereitungen treffen. Ersetze <code class="language-plaintext highlighter-rouge">username</code> und <code class="language-plaintext highlighter-rouge">remote-client</code> durch die richtigen Werte.</p>

<p>Hier wird ein neuer SSH-Key generiert:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-u</span> www-data ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096
<span class="nb">sudo</span> <span class="nt">-u</span> www-data ssh-copy-id username@remote-client

</code></pre></div></div>
<p>Danach kann eine Option ähnlich wie die Folgende eingestellt werden:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-o</span> <span class="s2">"StrictHostKeyChecking no"</span> user@remote-client <span class="s2">"export DISPLAY=:0.0 &amp;&amp; vlc -f --video-on-top --no-video-title-show --mouse-hide-timeout 1 rtmp://localhost/live/</span><span class="nv">$name</span><span class="s2">"</span><span class="p">;</span>
</code></pre></div></div>

    </div>
    <div class="col s12 m4 l3"> <!-- Note that "m4 l3" was added -->
        <h4>Links:</h4>
        
        <ul>
            <li><a class="btn waves-effect waves-light red" href="https://gist.github.com/noelli/489c5c0cf5a561a32f757d7513465344"><i class="fab fa-github"></i>  Github</a></li>
        </ul>   
        
    </div>
</div>

</div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="page-footer green darken-3">
    <div class="container">
      <div class="row center">
        <a class="white-text btn btn-flat" href="/datenschutz">Datenschutz</a>
        <a class="white-text btn btn-flat" href="/impressum">Impressum</a>
        <!-- normal settings maybe delete -->
        
        
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
        Made with <a class="white-text" href="http://materializecss.com">Materialize</a> and GitHub Pages
      </div>
    </div>
  </footer>

  <!-- Cookie Warning -->
  <!-- Modal Structure -->
  <div id="cookie" class="modal bottom-sheet">
    <div class="modal-content">
      <h4>Dürfen wir Cookies nutzen?</h4>
<p>
    Wenn wir keine Cookies setzen dürfen, wird diese Warnung bei jedem Besuch angezeigt.
</p>

    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close waves-effect waves-green btn-flat" onclick="_paq.push(['rememberConsentGiven']); setCookie('firsttime', true);">Ja</a>
      <a href="#!" class="modal-close waves-effect waves-green btn-flat">Nein</a>
    </div>
  </div>
  <!-- Scripts -->
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
  <script async src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script async src='/assets/js/materialize.js'></script>
  <script async src='/assets/js/init.js'></script>
</body>
</html>

