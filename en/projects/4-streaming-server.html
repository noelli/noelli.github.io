<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
  <title>noelli - Kind Gottes, Programmierer und IT-Spezialist</title>

  <!-- CSS -->
  <link rel="stylesheet" type="text/css" media="all" href='assets/css/min/index.min.css' />

  <link rel="preload" media="all" href='/assets/css/materialize.css' as="style" crossorigin="anonymous">
  <link rel="stylesheet" media="all" href='/assets/css/materialize.css'>

  <link rel="preload" media="all" href='/assets/css/style.css' as="style" >
  <link rel="stylesheet" media="all" href='/assets/css/style.css'>

  <link rel="preload" media="all" href="https://fonts.googleapis.com/icon?family=Material+Icons" as="style">
  <link rel="stylesheet" media="all" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    body {
      display: flex;
      min-height: 100vh;
      flex-direction: column;
    }
  
    main {
      flex: 1 0 auto;
    }

    .separator {
      display: flex;
      align-items: center;
      text-align: center;
    }
    .separator::before, .separator::after {
        content: '';
        flex: 1;
        margin-top: .5em;
        border-bottom: 1px solid #000;
    }
    .separator::before {
        margin-right: 1em;
    }
    .separator::after {
        margin-left: 1em;
    }

    .indent {
      margin-left: 10px;
    }
  </style>
<!-- Favicon -->
  <link rel="apple-touch-icon" sizes="57x57" href='/assets/images/favicon/apple-icon-57x57.png'>
  <link rel="apple-touch-icon" sizes="60x60" href='/assets/images/favicon/apple-icon-60x60.png'>
  <link rel="apple-touch-icon" sizes="72x72" href='/assets/images/favicon/apple-icon-72x72.png'>
  <link rel="apple-touch-icon" sizes="76x76" href='/assets/images/favicon/apple-icon-76x76.png'>
  <link rel="apple-touch-icon" sizes="114x114" href='/assets/images/favicon/apple-icon-114x114.png'>
  <link rel="apple-touch-icon" sizes="120x120" href='/assets/images/favicon/apple-icon-120x120.png'>
  <link rel="apple-touch-icon" sizes="144x144" href='/assets/images/favicon/apple-icon-144x144.png'>
  <link rel="apple-touch-icon" sizes="152x152" href='/assets/images/favicon/apple-icon-152x152.png'>
  <link rel="apple-touch-icon" sizes="180x180" href='/assets/images/favicon/apple-icon-180x180.png'>
  <link rel="icon" type="image/png" sizes="192x192"  href='/assets/images/favicon/android-icon-192x192.png'>
  <link rel="icon" type="image/png" sizes="32x32" href='/assets/images/favicon/favicon-32x32.png'>
  <link rel="icon" type="image/png" sizes="96x96" href='/assets/images/favicon/favicon-96x96.png'>
  <link rel="icon" type="image/png" sizes="16x16" href='/assets/images/favicon/favicon-16x16.png'>
  <link rel="manifest" href='/assets/images/favicon/manifest.json'>
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content='/assets/images/favicon/ms-icon-144x144.png'>
  <meta name="theme-color" content="#ffffff">


  
  <!-- Matomo -->
  <script type="text/javascript">

    function setCookie(c_name,value,exdays){var exdate=new Date();exdate.setDate(exdate.getDate() + exdays);var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());document.cookie=c_name + "=" + c_value;}
    function getCookie(c_name){var c_value = document.cookie;var c_start = c_value.indexOf(" " + c_name + "=");if (c_start == -1){c_start = c_value.indexOf(c_name + "=");}if (c_start == -1){c_value = null;}else{c_start = c_value.indexOf("=", c_start) + 1;var c_end = c_value.indexOf(";", c_start);if (c_end == -1){c_end = c_value.length;}c_value = unescape(c_value.substring(c_start,c_end));}return c_value;}
    function delCookie(name){document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';}

    var _paq = window._paq || [];
    _paq.push(['requireConsent']);
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setCookieDomain", "*.noell.li"]);
    _paq.push(["setDomains", ["*.noell.li","*.noell.li"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="https://stat.noell.li/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <noscript><p><img src="https://stat.noell.li/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt="" /></p></noscript>
  <!-- End Matomo Code -->
  
</head>
<body >


  <header>
  <!-- Navbar -->
  <div class="navbar-fixed">
    <!-- Dropdown Structure -->
    <ul id="dropdown1" class="dropdown-content">
      
        <li><a href="/projects/1-Ofenfrische-Pizza.html">Homepage für Ofenfrische Pizza Rossbach</a></li>
      
        <li><a href="/projects/2-QR-Translator.html">QR-Translator</a></li>
      
        <li><a href="/projects/3-Homepage.html">Diese Homepage</a></li>
      
        <li><a href="/projects/4-streaming-server.html">NGINX (Multi-) Streaming Server</a></li>
      
        <li><a href="/projects/WIP-BACnet-wiki.html">BACnet Wiki -WIP-</a></li>
      

    </ul>
    <nav class="green darken-3" role="navigation">
        <div class="nav-wrapper container">
            <a id="logo-container" href="/" class="brand-logo">
              <img class="navbar-fixed" src="/en/assets/generated/noelli-460-55588e8ae.png" srcset="/en/assets/generated/noelli-64-55588e8ae.png 64w">

            </a>
            <ul class="right hide-on-med-and-down">
              
              <li><a class="icon-large" target="_blank" href="https://github.com/noelli"><i class="fab fa-github"></i></a></li>
              
              
              
                
                <li><a href="/projects/4-streaming-server.html" >Deutsch</a></li>
              
              <!-- Dropdown Trigger -->
              <li><a class="dropdown-trigger" href="#" data-target="dropdown1">Projects<i class="material-icons right">arrow_drop_down</i></a></li>
            </ul>
            <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        </div>
    </nav>
  </div>
  <ul id="nav-mobile" class="sidenav">
      <li><a class="disabled">Links:</a></li>
      
      <li class="indent"><a class="icon-large" target="_blank" href="https://github.com/noelli"><i class="fab fa-github"></i> Github</a></li>
      
      
      
        
        <li class="indent"><a href="/projects/4-streaming-server.html" >Deutsch</a></li>
      
      <hr>
      <li><a class="disabled">Projects:</a></li>
      
        <li class="indent"><a href="/projects/1-Ofenfrische-Pizza.html" style="overflow: hidden;">Homepage für Ofenfrische Pizza Rossbach</a></li>
      
        <li class="indent"><a href="/projects/2-QR-Translator.html" style="overflow: hidden;">QR-Translator</a></li>
      
        <li class="indent"><a href="/projects/3-Homepage.html" style="overflow: hidden;">Diese Homepage</a></li>
      
        <li class="indent"><a href="/projects/4-streaming-server.html" style="overflow: hidden;">NGINX (Multi-) Streaming Server</a></li>
      
        <li class="indent"><a href="/projects/WIP-BACnet-wiki.html" style="overflow: hidden;">BACnet Wiki -WIP-</a></li>
      
  </ul>
  </header>
  
  <!-- MAIN Content -->
  <main>
    <div class="section no-pad-bot" id="index-banner">
      <!-- MAIN Content -->
<div class="container">
    <!-- MAIN Content -->
<div class="row">
    <div class="col s12 m8 l9"><h1>NGINX (Multi-) Streaming Server</h1></div>
</div>
<div class="row">
    <div class="col s12 m8 l9"> <!-- Note that "m8 l9" was added -->
        <!-- ToDo: Add translation -->
<h4 id="introduction">Introduction</h4>
<p>This installation Tutorial and the corresponding Scripts were initially provided within a <a href="https://gist.github.com/noelli/489c5c0cf5a561a32f757d7513465344">Gist</a> and help with the installation of a custom RTMP Server using NGINX.</p>

<p>We did not only want to Stream to many different Services like Youtube, Twitch and Facebook but also wanted to playback Streams locally in different Rooms with little to zero latency. Which is not possible if you use a Streaming Service in the Cloud. So we needed a Local Multi-Streaming Provider, as shown in the Diagram below.</p>

<p>We managed to get there with the provided Instructions and Scripts, running on a low-cost Raspberry Pi 4, with the only Bottleneck being the Internet Connection!</p>

<p><img src="/assets/images/NGINXStreamingServer.svg" alt="Network Diagram of a local NGINX Streaming Server by noell.li" style="     margin-top: 50px;     margin-bottom: 50px;     width: 100%; " /></p>

<h2 id="compile-nginx-with-rtmp-and-setup-multi-streaming">Compile NGINX with RTMP and setup Multi-Streaming</h2>
<p>These Scripts will install NGINX with the RTMP Module in the usual directories similar to installation with apt-get.</p>

<p>The RTMP-Server you get with this can then be used to do one ore more of the following:</p>
<ul>
  <li>deliver streams in a local network</li>
  <li>transcode rtmp streams to hls video</li>
  <li>publish to one or multiple streaming providers i.e. Youtube</li>
  <li>record livestreams to a harddrive</li>
  <li>many, many more: Check the Docs on <a href="https://github.com/arut/nginx-rtmp-module/wiki/Directives">Nginx RTMP-Module</a></li>
</ul>

<p>And it also runs flawless on the Raspberry Pi 4!</p>

<h2 id="installation">Installation</h2>
<p>If git is not present, install it: <a href="https://git-scm.com/downloads">Download Git</a></p>

<p>Get the Scripts:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://gist.github.com/489c5c0cf5a561a32f757d7513465344.git install_nginx
</code></pre></div></div>

<p>Change into the directory:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>install_nginx
</code></pre></div></div>

<p>Then Run the main Script:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo install </span>install_nginx.sh
</code></pre></div></div>

<h3 id="pulish-to-your-new-rtmp-server">Pulish to your new RTMP-Server:</h3>
<p>Publish from OBS or another Streaming-Device to the following URL (where hostname is the Name or IP of your server).</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rtmp://hostname:1935/live
</code></pre></div></div>
<p>If you have an api-key for example to publish to youtube, either set it in your OBS or alter the URL like so:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rtmp://hostname:1935/live/your-api-key
</code></pre></div></div>

<h2 id="explanation-and-options">Explanation and Options</h2>
<p>This script installs a rtmp-config which accepts Livestreams and accepts client-connections to play them.</p>

<p>By default the following options are disabled in the configuration file nginx.conf but you can enable and alter them according to your scenario:</p>

<h3 id="publishing-to-streaming-service-ie-youtube">Publishing to Streaming-Service (i.e. Youtube):</h3>
<p>If you enable the push option, every published stream will also be pushed to the provided server, by default youtube.</p>

<h3 id="local-vlc-playback-ie-on-raspberry-pi">local VLC Playback (i.e. on Raspberry Pi):</h3>
<p>The second option is very handy if you want to Livestream into the internet but have to also Stream into another Room/Location at your site where an audience is watching.</p>

<p>The command after exec_publish will be executed when starting a livestream and will be killed on stop.</p>

<h3 id="remote-vlc-playback">remote VLC Playback</h3>
<p>The Command can be altered to start the VLC-Window on another device if you use it with ssh.</p>

<p>To get this running you will have to do some things first, replace username and remote-client with the values fitting your setup:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-u</span> www-data ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096
<span class="nb">sudo</span> <span class="nt">-u</span> www-data ssh-copy-id username@remote-client

</code></pre></div></div>
<p>After that you can enable an option similar to this:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-o</span> <span class="s2">"StrictHostKeyChecking no"</span> user@remote-client <span class="s2">"export DISPLAY=:0.0 &amp;&amp; vlc -f --video-on-top --no-video-title-show --mouse-hide-timeout 1 rtmp://localhost/live/</span><span class="nv">$name</span><span class="s2">"</span><span class="p">;</span>
</code></pre></div></div>

<p>To see what the Scripts do exactly or what the config means, look into the Files below.</p>


    </div>
    <div class="col s12 m4 l3"> <!-- Note that "m4 l3" was added -->
        <h4>Links:</h4>
        
        <ul>
            <li><a class="btn waves-effect waves-light red" href="https://gist.github.com/noelli/489c5c0cf5a561a32f757d7513465344"><i class="fab fa-github"></i>  Github</a></li>
        </ul>   
        
    </div>
</div>

</div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="page-footer green darken-3">
    <div class="container">
      <div class="row center">
        <a class="white-text btn btn-flat" href="/datenschutz">Privacy</a>
        <a class="white-text btn btn-flat" href="/impressum">Imprint</a>
        <!-- normal settings maybe delete -->
        
        
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
        Made with <a class="white-text" href="http://materializecss.com">Materialize</a> and GitHub Pages
      </div>
    </div>
  </footer>

  <!-- Cookie Warning -->
  <!-- Modal Structure -->
  <div id="cookie" class="modal bottom-sheet">
    <div class="modal-content">
      <h4>Do you want us to set Cookies?</h4>
<p>
    If we are not allowed to set Cookies this warning will appear on every Visit.
</p>

    </div>
    <div class="modal-footer">
      <a href="#" class="modal-close waves-effect waves-green btn-flat" onclick="_paq.push(['rememberConsentGiven']); setCookie('firsttime', true);">Yes</a>
      <a href="#" class="modal-close waves-effect waves-green btn-flat">No</a>
    </div>
  </div>
  <!-- Scripts -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
  <script defer src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script defer src='/assets/js/materialize.js'></script>
  <script defer src='/assets/js/init.js'></script>
</body>
</html>

